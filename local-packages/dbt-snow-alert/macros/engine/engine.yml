version: 2

macros:
  - name: send_alert
    description: |
      Main function of the alert.
      
      Generate SQL script and execute a the alert query, collect failed count, and alert an email if failed count > 0.

      Behind the scenes, it calls `system$send_email` function within the `execute immediate` statement.
  - name: create_or_get_resource
    description: |
      Generate the managed SQL script for the Snowflake Notification Integration object.

      Returns the object name if called by others by default.

      Usage:

      - Get script for a manual execution:
      ```bash
      dbt run-operation create_or_get_resource --args '{create: true}'
      ```

      - Get script for a manual execution, with diffent role assignee:
      ```bash
      dbt run-operation create_or_get_resource --args '{create: true, assign_to_role: "my_role"}'
      ```

      - Return the notification integration name in other macro(s):
      ```sql
      {% raw %}
      {% set ni_name = snow_alert.create_or_get_resource() %}
      {% endraw %}
      ```
  - name: get_mailing_list
    description: |
      Return the mailing list splitted by comma from `snow_alert__mailing_list` variable, or `DBT_CLOUD_MAILING_LIST` environment variable